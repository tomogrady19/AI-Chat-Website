<!DOCTYPE html>
<html>

<!--browser tab title-->
<head>
    <title>Ask My AI</title>
</head>

<!--page content-->
<body>
    <h1>Ask My AI Anything</h1> <!--title-->

    <!-- Chat window -->
    <div id="chat" style="border:1px solid #ccc; padding:10px; width:400px; height:300px; overflow-y:auto; margin-bottom:10px;"></div>
    <input id="userInput" placeholder="Type a question..." style="width: 300px;" onkeydown="handleKey(event)"> <!--input box-->
    <button onclick="askAI()">Ask</button> <!--clickable button, calls askAI() function-->

    <script>
        let messages = []; // stores chat history

        async function askAI() {
            const prompt = document.getElementById("userInput").value.trim(); // set prompt to the user input
            if (!prompt) return;

            messages.push({ role: "user", content: prompt }) // add new prompt to messages
            updateChat();

            // process request via backend
            const res = await fetch("/api/ask", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ messages })
            });

            const data = await res.json(); //extract data from json response
            messages.push({ role: "assistant", content: data.output });
            updateChat()
        }
        function updateChat() {
            const chat = document.getElementById("chat"); //get chat from webpage
            chat.innerHTML = ""; //clear chat content

            // repopulate entire chat from scratch
            messages.forEach(msg => {
                const who = msg.role === "user" ? "You" : "AI"; // if msg.role == "user", who == "You" else "AI"
                chat.innerHTML += `<p><strong>${who}:</strong> ${msg.content}</p>`;
            });
        chat.scrollTop = chat.scrollHeight; // scroll to bottom of chat
        }
        function handleKey(event) {
            if (event.key === "Enter") {
                event.preventDefault(); // stop default behavior when Enter is clicked
                askAI(); // sends the message
            }
        }
    </script>
</body>
</html>
